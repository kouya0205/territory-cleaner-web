# Territory Cleaner (Web MVP)

WebXR ARを使った掃除可視化アプリケーションのMVP。

## プロジェクト概要

スマートフォンのブラウザからアクセスし、ARで現実空間にオブジェクトを配置できる基本機能を提供します。

## 現在の実装

### ✅ 実装済み機能
- Next.js + A-FrameによるWebXR AR基盤
- ARセッションの開始/終了
- 床面検出（Hit Test）とレティクル表示
- テスト用3Dオブジェクト（立方体）の表示
- WebXR対応チェック機能

### 📁 ファイル構成

```
src/
├── app/
│   ├── layout.tsx           # アプリケーションレイアウト
│   └── page.tsx             # メインページ（ARシーン統合）
├── components/
│   ├── ARView.js            # A-FrameベースのARシーン
│   ├── aframe-ar-cursor.js  # 床面検出・レティクルシステム
│   └── XRSupportBanner.tsx  # WebXR未対応時の案内
└── types/
    └── aframe.d.ts          # A-Frame JSX型定義
```

## 技術スタック

- **Next.js 15** (App Router, React 19)
- **A-Frame 1.7.1** (WebXR ARフレームワーク)
- **Three.js** (A-Frame内包)
- **WebXR Device API**
- **Tailwind CSS**

## セットアップ・起動

### 依存関係のインストール

```bash
npm install
```

### 開発サーバーの起動

```bash
npm run dev
```

デフォルトでは `http://localhost:3000` で起動します。

### 本番ビルド

```bash
npm run build
npm start
```

## 使い方

### 必要な環境
- **WebXR対応モバイルブラウザ**（Android Chrome、Edgeなど）
- **HTTPS接続**（本番環境）または `localhost`（開発環境）
- **カメラ使用許可**

### 手順

1. **WebXR対応スマートフォンでアクセス**
   - 開発サーバーのURLにアクセス

2. **画面の確認**
   - 青い立方体が表示される（テスト用3Dオブジェクト）
   - 下部に「START AR」「EXIT AR」ボタンが表示される

3. **ARセッション開始**
   - 「START AR」ボタンをタップ
   - カメラ許可を求められたら許可
   - ARセッションが開始される

4. **床面検出**
   - 床を向けると緑の円（レティクル）が表示される
   - これは床面が検出されている証拠

5. **ARセッション終了**
   - 「EXIT AR」ボタンでARモードを終了

## 画面構成

```
┌──────────────────────────────────┐
│ [WebXR未対応バナー]（該当時のみ）│
│                                  │
│ Territory Cleaner AR            │ ← 左上
│ 床を向けてください              │
│                                  │
│      （A-Frameシーン）           │
│       🔵 青い立方体              │
│       🟢 緑の円（レティクル）    │
│                                  │
│                                  │
│   [START AR]  [EXIT AR]         │ ← 下部
└──────────────────────────────────┘
```

## 動作確認

### デスクトップブラウザ
- A-Frameシーンと青い立方体が表示される
- START ARボタンは機能しない（WebXR AR非対応のため）

### モバイルブラウザ（WebXR対応）
- START ARでARセッション開始
- カメラ映像が表示される
- 床を向けると緑のレティクルが表示される

## 今後の拡張

1. **カメラフレーム取得**
   - getUserMediaでカメラストリームを取得
   - OpenCVでマーカー色検出

2. **軌跡描画システム**
   - 床面にcanvasテクスチャを配置
   - マーカー位置に沿って描画

3. **掃除面積計算**
   - 描画されたピクセル数をカウント
   - パーセンテージ表示

4. **UX改善**
   - 掃除道具選択UI
   - ヒートマップ表示
   - 掃除履歴の保存

## トラブルシューティング

### 問題: 白い画面のまま何も表示されない
- **原因**: A-Frameの読み込みエラー
- **解決**: ブラウザコンソールでエラーを確認、ページをリロード

### 問題: START ARを押してもカメラが起動しない
- **原因**: WebXR非対応環境、またはHTTPS以外の接続
- **解決**: 対応ブラウザ・端末で、HTTPSまたはlocalhostでアクセス

### 問題: 緑のレティクルが表示されない
- **原因**: 床面が検出できていない
- **解決**: 床をゆっくりスキャンするように動かす

## ライセンス

MIT License

## 作成者

Territory Cleaner Development Team
